<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Too Turned Trivia™</title>
    <meta name="description" content="Online multiplayer trivia with 6 unique game modes">
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --black: #000000;
            --white: #FFFFFF;
            --yellow: #FFDE21;
            --yellow-dark: #E6C500;
            --gray-900: #0F0F0F;
            --gray-800: #1A1A1A;
            --gray-700: #2D2D2D;
            --gray-400: #9E9E9E;
            --purple: #6C5CE7;
            --red: #FF7675;
            --orange: #FDCB6E;
            --green: #00B894;
            --cyan: #00CEC9;
            --pink: #FD79A8;
            
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            
            --radius-lg: 18px;
            --radius-md: 12px;
            
            --shadow-card: 0 8px 20px rgba(0, 0, 0, 0.12);
            --shadow-card-hover: 0 12px 30px rgba(0, 0, 0, 0.25);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== LOADING SCREEN ===== */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--black);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }

        .loading-logo {
            font-size: 80px;
            font-weight: 900;
            color: var(--yellow);
            animation: pulse 2s infinite;
            transform: rotate(-15deg);
            margin-bottom: var(--space-xl);
        }

        .loading-progress {
            width: min(300px, 90vw);
            height: 6px;
            background: var(--gray-800);
            border-radius: 9999px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--yellow), var(--orange));
            transition: width 0.3s ease;
        }

        .loading-text {
            margin-top: var(--space-md);
            color: var(--gray-400);
            font-size: 14px;
            font-weight: 500;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: rotate(-15deg) scale(1); }
            50% { opacity: 0.7; transform: rotate(-15deg) scale(1.05); }
        }

        /* ===== PLAYER HUD ===== */
        .player-hud {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            padding: var(--space-sm) var(--space-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 222, 33, 0.1);
        }

        .hud-left {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }

        .hud-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .hud-icon {
            width: 32px;
            height: 32px;
            background: var(--gray-800);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--yellow);
        }

        .hud-value {
            font-weight: 700;
            font-size: 16px;
        }

        .hud-label {
            font-size: 12px;
            color: var(--gray-400);
            margin-top: -2px;
        }

        .hud-right {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        /* ===== SCREENS ===== */
        .screen {
            display: none;
            min-height: 100vh;
            padding-top: 60px;
        }

        .screen.active {
            display: block;
        }

        .page-content {
            padding: var(--space-xl) var(--space-md);
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ===== BOTTOM NAVIGATION ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 100;
            border-top: 1px solid rgba(255, 222, 33, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--gray-400);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px 16px;
            border-radius: var(--radius-md);
        }

        .nav-item.active {
            color: var(--yellow);
            background: rgba(255, 222, 33, 0.1);
        }

        .nav-icon {
            font-size: 20px;
        }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 48px;
            padding: var(--space-sm) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            gap: var(--space-sm);
        }

        .btn-primary {
            background: var(--yellow);
            color: var(--black);
        }

        .btn-primary:hover {
            background: var(--yellow-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 222, 33, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: var(--yellow);
            border: 2px solid var(--yellow);
        }

        .btn-outline:hover {
            background: rgba(255, 222, 33, 0.1);
        }

        .btn-full {
            width: 100%;
        }

        .btn-lg {
            min-height: 56px;
            font-size: 18px;
            font-weight: 700;
        }

        .btn-sm {
            padding: 6px 12px;
            min-height: 36px;
            font-size: 14px;
        }

        /* ===== CARD STYLES ===== */
        .card {
            background: var(--gray-800);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-card);
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-card-hover);
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-lg);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: var(--space-md);
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .card-description {
            color: var(--gray-400);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: var(--space-md);
        }

        .card-progress {
            height: 4px;
            background: var(--gray-700);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: var(--space-sm);
        }

        .card-progress-fill {
            height: 100%;
            border-radius: 2px;
        }

        .card-rarity {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rarity-common { background: rgba(108, 92, 231, 0.2); color: var(--purple); }
        .rarity-rare { background: rgba(255, 118, 117, 0.2); color: var(--red); }
        .rarity-epic { background: rgba(253, 203, 110, 0.2); color: var(--orange); }
        .rarity-legendary { background: rgba(0, 184, 148, 0.2); color: var(--green); }

        /* ===== HOME SCREEN ===== */
        .hero-section {
            text-align: center;
            padding: var(--space-xl) 0;
            margin-bottom: var(--space-xl);
            position: relative;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 222, 33, 0.1) 0%, transparent 70%);
            z-index: -1;
        }

        .hero-title {
            font-size: clamp(36px, 6vw, 48px);
            font-weight: 900;
            margin-bottom: var(--space-md);
            background: linear-gradient(135deg, var(--yellow) 0%, var(--orange) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .hero-subtitle {
            color: var(--gray-400);
            max-width: 600px;
            margin: 0 auto var(--space-xl);
            font-size: clamp(16px, 2.5vw, 20px);
        }

        .hero-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ===== GAME MODES SCREEN ===== */
        .modes-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }

        .section-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: var(--space-sm);
            background: linear-gradient(135deg, var(--yellow) 0%, var(--orange) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .section-subtitle {
            color: var(--gray-400);
            max-width: 600px;
            margin: 0 auto;
        }

        /* ===== PLAYER SETUP ===== */
        .setup-stepper {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            position: relative;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            position: relative;
            z-index: 1;
        }

        .step-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gray-800);
            color: var(--gray-400);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .step.active .step-circle {
            background: var(--yellow);
            color: var(--black);
            border-color: var(--yellow);
            box-shadow: 0 0 0 4px rgba(255, 222, 33, 0.2);
        }

        .step-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .step.active .step-label {
            color: var(--yellow);
        }

        .setup-content {
            background: var(--gray-800);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
        }

        .setup-section {
            display: none;
        }

        .setup-section.active {
            display: block;
        }

        .players-list {
            margin-bottom: var(--space-lg);
        }

        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md);
            background: var(--gray-700);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
            transition: all 0.2s;
        }

        .player-item:hover {
            background: var(--gray-600);
        }

        .player-name {
            font-weight: 600;
        }

        /* ===== GAME SCREEN ===== */
        .game-header {
            background: var(--gray-800);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            border: 1px solid rgba(255, 222, 33, 0.1);
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            gap: var(--space-lg);
            margin-bottom: var(--space-md);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--yellow);
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-mode-badge {
            background: var(--gray-700);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }

        .timer-display {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .question-card {
            background: var(--gray-800);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-card);
        }

        .question-header {
            padding: var(--space-lg);
            background: linear-gradient(135deg, var(--gray-700) 0%, var(--gray-800) 100%);
            border-bottom: 1px solid var(--gray-700);
        }

        .question-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
        }

        .question-category {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--gray-400);
            font-size: 14px;
        }

        .question-text {
            padding: var(--space-lg);
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            line-height: 1.4;
        }

        .answers-grid {
            padding: var(--space-lg);
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-md);
        }

        @media (min-width: 640px) {
            .answers-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .answer-option {
            padding: var(--space-lg);
            background: var(--gray-700);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .answer-option:hover {
            background: var(--gray-600);
            transform: translateY(-2px);
        }

        .answer-option.selected {
            background: rgba(0, 184, 148, 0.2);
            border: 2px solid var(--green);
        }

        .answer-option.incorrect {
            background: rgba(255, 118, 117, 0.2);
            border: 2px solid var(--red);
        }

        .answer-letter {
            width: 36px;
            height: 36px;
            background: var(--gray-600);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .answer-option.selected .answer-letter {
            background: var(--green);
            color: white;
        }

        .answer-option.incorrect .answer-letter {
            background: var(--red);
            color: white;
        }

        .game-controls {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
        }

        /* ===== CARDS SCREEN ===== */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--space-lg);
        }

        .category-card {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .category-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--space-md);
        }

        /* ===== PROFILE SCREEN ===== */
        .profile-header {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--purple), var(--cyan));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 700;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: var(--space-sm);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .stat-card {
            text-align: center;
            padding: var(--space-lg);
        }

        .stat-value-lg {
            font-size: 36px;
            font-weight: 800;
            color: var(--yellow);
            margin-bottom: var(--space-sm);
        }

        /* ===== ONLINE SCREEN ===== */
        .online-actions {
            display: flex;
            gap: var(--space-lg);
            justify-content: center;
            margin-bottom: var(--space-xl);
        }

        .lobby-container {
            background: var(--gray-800);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
        }

        .room-list {
            margin-top: var(--space-lg);
        }

        .room-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            background: var(--gray-700);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
        }

        /* ===== WAITING ROOM ===== */
        .waiting-room {
            text-align: center;
        }

        .room-code {
            font-size: 48px;
            font-weight: 900;
            letter-spacing: 8px;
            color: var(--yellow);
            margin: var(--space-xl) 0;
            padding: var(--space-md);
            background: var(--gray-800);
            border-radius: var(--radius-md);
            border: 2px dashed var(--yellow);
        }

        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: var(--space-md);
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--gray-800);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: var(--space-xl);
            text-align: center;
            border-bottom: 1px solid var(--gray-700);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: var(--space-lg);
            right: var(--space-lg);
            background: none;
            border: none;
            color: var(--gray-400);
            font-size: 24px;
            cursor: pointer;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: var(--space-sm);
        }

        .modal-subtitle {
            color: var(--gray-400);
            font-size: 14px;
        }

        .modal-body {
            padding: var(--space-xl);
        }

        .modal-footer {
            padding: var(--space-xl);
            border-top: 1px solid var(--gray-700);
            display: flex;
            gap: var(--space-md);
            justify-content: center;
        }

        /* ===== FORM ELEMENTS ===== */
        .form-input {
            width: 100%;
            padding: var(--space-md);
            background: var(--gray-700);
            border: 2px solid var(--gray-600);
            border-radius: var(--radius-md);
            color: var(--white);
            font-family: inherit;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--yellow);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 600;
        }

        .select-dropdown {
            width: 100%;
            padding: var(--space-md);
            background: var(--gray-700);
            border: 2px solid var(--gray-600);
            border-radius: var(--radius-md);
            color: var(--white);
            font-family: inherit;
            font-size: 16px;
            cursor: pointer;
        }

        .select-dropdown:focus {
            outline: none;
            border-color: var(--yellow);
        }

        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-yellow { color: var(--yellow); }
        .text-purple { color: var(--purple); }
        .text-red { color: var(--red); }
        .text-green { color: var(--green); }
        .text-orange { color: var(--orange); }
        .mt-sm { margin-top: var(--space-sm); }
        .mt-md { margin-top: var(--space-md); }
        .mt-lg { margin-top: var(--space-lg); }
        .mt-xl { margin-top: var(--space-xl); }
        .mb-sm { margin-bottom: var(--space-sm); }
        .mb-md { margin-bottom: var(--space-md); }
        .mb-lg { margin-bottom: var(--space-lg); }
        .mb-xl { margin-bottom: var(--space-xl); }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-sm { gap: var(--space-sm); }
        .gap-md { gap: var(--space-md); }
        .gap-lg { gap: var(--space-lg); }
        .w-full { width: 100%; }
        .relative { position: relative; }
        .flex-1 { flex: 1; }

        /* ===== FEEDBACK ANIMATIONS ===== */
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            40% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        .feedback-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            padding: 16px 32px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 20px;
            animation: fadeInOut 1.5s ease;
            pointer-events: none;
        }

        .feedback-correct {
            background: var(--green);
            color: white;
        }

        .feedback-incorrect {
            background: var(--red);
            color: white;
        }

        /* ===== BUZZER MODE STYLES ===== */
        .buzzer-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
            margin-top: var(--space-xl);
        }

        .buzzer-button {
            height: 200px;
            font-size: 48px;
            font-weight: 900;
            border-radius: var(--radius-lg);
            border: none;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }

        .buzzer-button:active {
            transform: scale(0.95);
        }

        .buzzer-ready {
            background: var(--green);
            color: white;
        }

        .buzzer-buzzed {
            background: var(--yellow);
            color: var(--black);
        }

        .buzzer-disabled {
            background: var(--gray-700);
            color: var(--gray-400);
            cursor: not-allowed;
        }

        .buzzer-status {
            text-align: center;
            padding: var(--space-lg);
            background: var(--gray-800);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-lg);
        }

        .player-buzzed {
            font-size: 24px;
            font-weight: 700;
            color: var(--yellow);
            margin-top: var(--space-sm);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 639px) {
            .hero-actions {
                flex-direction: column;
            }
            
            .hero-actions .btn {
                width: 100%;
            }
            
            .game-controls {
                flex-direction: column;
            }
            
            .game-controls .btn {
                width: 100%;
            }
            
            .card-grid, .categories-grid {
                grid-template-columns: 1fr;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .online-actions {
                flex-direction: column;
            }

            .modal-footer {
                flex-direction: column;
            }

            .modal-footer .btn {
                width: 100%;
            }
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-800);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-600);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-logo">T</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgress"></div>
        </div>
        <div class="loading-text" id="loadingText">Initializing...</div>
    </div>

    <!-- Player HUD -->
    <div class="player-hud">
        <div class="hud-left">
            <div class="hud-item">
                <div class="hud-icon">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <div class="hud-value" id="playerName">Player</div>
                    <div class="hud-label">Profile</div>
                </div>
            </div>
        </div>
        
        <div class="hud-right">
            <div class="hud-item">
                <div class="hud-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div>
                    <div class="hud-value" id="playerScoreHud">0</div>
                    <div class="hud-label">Score</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Screens -->
    <main>
        <!-- Home Screen -->
        <div class="screen active" id="homeScreen">
            <div class="page-content">
                <section class="hero-section">
                    <h1 class="hero-title">Too Turned Trivia™</h1>
                    <p class="hero-subtitle">Challenge your mind with 6 unique game modes. Play solo or with friends!</p>
                    <div class="hero-actions">
                        <button class="btn btn-primary btn-lg" data-screen="modes">
                            <i class="fas fa-play-circle"></i> Play Now
                        </button>
                        <button class="btn btn-outline btn-lg" data-screen="online">
                            <i class="fas fa-wifi"></i> Online Play
                        </button>
                    </div>
                </section>

                <div class="card-grid">
                    <div class="card" data-screen="modes">
                        <div class="card-icon" style="background: rgba(108, 92, 231, 0.2); color: var(--purple);">
                            <i class="fas fa-crown"></i>
                        </div>
                        <h3 class="card-title">6 Game Modes</h3>
                        <p class="card-description">Classic, Countdown, Ladder, Battle, Buzzer, and Solo challenges with unique rules</p>
                        <div class="card-progress">
                            <div class="card-progress-fill" style="width: 100%; background: var(--purple);"></div>
                        </div>
                        <span class="card-rarity rarity-common">Unlocked</span>
                    </div>
                    
                    <div class="card" data-screen="cards">
                        <div class="card-icon" style="background: rgba(255, 118, 117, 0.2); color: var(--red);">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <h3 class="card-title">Categories</h3>
                        <p class="card-description">Science, History, Entertainment, Sports, Geography, and more</p>
                        <div class="card-progress">
                            <div class="card-progress-fill" style="width: 100%; background: var(--red);"></div>
                        </div>
                        <span class="card-rarity rarity-rare">All Unlocked</span>
                    </div>
                    
                    <div class="card" data-screen="stats">
                        <div class="card-icon" style="background: rgba(253, 203, 110, 0.2); color: var(--orange);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="card-title">Stats & Rankings</h3>
                        <p class="card-description">Track your progress and compete on global leaderboards</p>
                        <div class="card-progress">
                            <div class="card-progress-fill" style="width: 65%; background: var(--orange);"></div>
                        </div>
                        <span class="card-rarity rarity-epic">Rank #1,245</span>
                    </div>
                    
                    <div class="card" data-screen="profile">
                        <div class="card-icon" style="background: rgba(0, 184, 148, 0.2); color: var(--green);">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <h3 class="card-title">My Profile</h3>
                        <p class="card-description">Customize your avatar and view achievements</p>
                        <div class="card-progress">
                            <div class="card-progress-fill" style="width: 88%; background: var(--green);"></div>
                        </div>
                        <span class="card-rarity rarity-legendary">Legendary</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Modes Screen -->
        <div class="screen" id="modesScreen">
            <div class="page-content">
                <div class="modes-header">
                    <h2 class="section-title">Choose Your Mode</h2>
                    <p class="section-subtitle">Each mode has unique rules and challenges. Select one to begin!</p>
                </div>
                
                <div class="card-grid" id="modesGrid">
                    <!-- Modes will be dynamically loaded -->
                </div>
            </div>
        </div>

        <!-- Cards/Categories Screen -->
        <div class="screen" id="cardsScreen">
            <div class="page-content">
                <div class="modes-header">
                    <h2 class="section-title">Categories</h2>
                    <p class="section-subtitle">Explore different trivia categories and track your progress</p>
                </div>
                
                <div class="categories-grid" id="categoriesGrid">
                    <!-- Categories will be dynamically loaded -->
                </div>
            </div>
        </div>

        <!-- Profile Screen -->
        <div class="screen" id="profileScreen">
            <div class="page-content">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">P</div>
                    <div class="profile-info">
                        <h1 class="profile-name" id="profileName">Player</h1>
                        <p class="text-gray-400">Trivia Master</p>
                    </div>
                </div>

                <div class="profile-stats">
                    <div class="stat-card card">
                        <div class="stat-value-lg" id="totalGames">0</div>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-card card">
                        <div class="stat-value-lg" id="correctAnswers">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat-card card">
                        <div class="stat-value-lg" id="highestStreak">0</div>
                        <div class="stat-label">Highest Streak</div>
                    </div>
                    <div class="stat-card card">
                        <div class="stat-value-lg" id="totalScore">0</div>
                        <div class="stat-label">Total Score</div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title mb-lg">Achievements</h3>
                    <div id="achievementsList">
                        <!-- Achievements will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Local Play Setup -->
        <div class="screen" id="playScreen">
            <div class="page-content">
                <div class="modes-header">
                    <h2 class="section-title" id="setupModeTitle">Local Play</h2>
                    <p class="section-subtitle" id="setupModeDescription">Play offline with friends and family</p>
                </div>

                <div class="setup-stepper">
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Players</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Settings</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Start</div>
                    </div>
                </div>

                <div class="setup-content">
                    <!-- Step 1: Players -->
                    <div class="setup-section active" data-step="1">
                        <h3 class="text-center mb-lg">Add Players</h3>
                        <p class="text-center text-gray-400 mb-lg">Add at least 2 players to start the game</p>
                        
                        <div class="players-list" id="playersList">
                            <!-- Players will be added here -->
                        </div>
                        
                        <div class="flex gap-sm mt-lg">
                            <input 
                                type="text" 
                                id="playerNameInput"
                                class="form-input w-full"
                                placeholder="Enter player name"
                                maxlength="20"
                            />
                            <button id="addPlayerBtn" class="btn btn-primary">
                                Add
                            </button>
                        </div>
                        
                        <button class="btn btn-primary btn-full mt-lg" id="nextStepBtn">
                            Continue to Settings
                        </button>
                    </div>

                    <!-- Step 2: Game Settings -->
                    <div class="setup-section" data-step="2">
                        <h3 class="text-center mb-lg">Game Settings</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Number of Questions</label>
                            <select class="select-dropdown" id="questionCount">
                                <option value="5">5 Questions</option>
                                <option value="10" selected>10 Questions</option>
                                <option value="15">15 Questions</option>
                                <option value="20">20 Questions</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="select-dropdown" id="categorySelect">
                                <!-- Categories will be populated dynamically -->
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Difficulty</label>
                            <select class="select-dropdown" id="difficultySelect">
                                <option value="easy">Easy</option>
                                <option value="medium" selected>Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                        
                        <div class="flex gap-sm mt-lg">
                            <button class="btn btn-outline flex-1" id="prevStepBtn">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                            <button class="btn btn-primary flex-1" id="nextStepBtn2">
                                Continue <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Start Game -->
                    <div class="setup-section" data-step="3">
                        <h3 class="text-center mb-lg">Ready to Play!</h3>
                        
                        <div class="card mb-lg">
                            <div class="text-center mb-md">
                                <div class="text-yellow text-xl font-bold" id="selectedModeName">Classic Mode</div>
                                <div class="text-sm text-gray-400 mt-sm" id="selectedModeDescription">Traditional question/answer format</div>
                            </div>
                            
                            <div class="players-list" id="finalPlayersList">
                                <!-- Final players list -->
                            </div>

                            <div class="mt-md text-center text-gray-400">
                                <div><i class="fas fa-question-circle"></i> <span id="settingsQuestionCount">10</span> Questions</div>
                                <div><i class="fas fa-tag"></i> <span id="settingsCategory">General Knowledge</span></div>
                                <div><i class="fas fa-chart-line"></i> <span id="settingsDifficulty">Medium</span> Difficulty</div>
                            </div>
                        </div>
                        
                        <div class="flex gap-sm">
                            <button class="btn btn-outline flex-1" id="prevStepBtn2">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                            <button class="btn btn-primary flex-1" id="startGameBtn">
                                <i class="fas fa-play"></i> Start Game
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Online Screen -->
        <div class="screen" id="onlineScreen">
            <div class="page-content">
                <div class="modes-header">
                    <h2 class="section-title">Online Play</h2>
                    <p class="section-subtitle">Play with friends or random players from around the world</p>
                </div>

                <div class="online-actions">
                    <button class="btn btn-primary btn-lg" id="createRoomBtn">
                        <i class="fas fa-plus-circle"></i> Create Room
                    </button>
                    <button class="btn btn-outline btn-lg" id="joinRoomBtn">
                        <i class="fas fa-sign-in-alt"></i> Join Room
                    </button>
                </div>

                <div class="lobby-container card">
                    <h3 class="card-title mb-lg">Available Rooms</h3>
                    <div class="room-list" id="roomList">
                        <!-- Rooms will be dynamically loaded -->
                    </div>
                    <button class="btn btn-outline btn-full mt-lg" id="refreshRoomsBtn">
                        <i class="fas fa-sync-alt"></i> Refresh Rooms
                    </button>
                </div>
            </div>
        </div>

        <!-- Waiting Room Screen -->
        <div class="screen" id="waitingScreen">
            <div class="page-content">
                <div class="waiting-room">
                    <h2 class="section-title">Waiting Room</h2>
                    <p class="section-subtitle mb-lg">Share the code below with other players to join</p>
                    
                    <div class="room-code" id="roomCodeDisplay">ABC123</div>
                    
                    <div class="card mb-lg">
                        <h3 class="card-title mb-md">Connected Players</h3>
                        <div class="players-list" id="onlinePlayersList">
                            <!-- Online players will be listed here -->
                        </div>
                    </div>

                    <div class="game-settings mb-lg">
                        <h3 class="card-title mb-md">Room Settings</h3>
                        <div class="text-center text-gray-400">
                            <div><i class="fas fa-gamepad"></i> Mode: <span id="roomMode">Classic</span></div>
                            <div><i class="fas fa-question-circle"></i> Questions: <span id="roomQuestions">10</span></div>
                            <div><i class="fas fa-tag"></i> Category: <span id="roomCategory">General</span></div>
                        </div>
                    </div>

                    <div class="flex gap-sm">
                        <button class="btn btn-outline flex-1" id="leaveRoomBtn">
                            <i class="fas fa-sign-out-alt"></i> Leave
                        </button>
                        <button class="btn btn-primary flex-1" id="startOnlineGameBtn" disabled>
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="gameScreen">
            <div class="page-content">
                <div class="game-header">
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="playerScore">0</div>
                            <div class="stat-label">Score</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="currentQuestionNum">1/10</div>
                            <div class="stat-label">Question</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="playerLives">3</div>
                            <div class="stat-label">Lives</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="timeBonus">0</div>
                            <div class="stat-label">Bonus</div>
                        </div>
                    </div>
                    
                    <div class="game-info">
                        <div class="game-mode-badge" id="currentGameMode">
                            <i class="fas fa-gamepad"></i> <span id="modeName">Classic</span>
                        </div>
                        <div class="timer-display">
                            <i class="fas fa-clock text-yellow"></i>
                            <span class="font-bold" id="gameTimer">30s</span>
                        </div>
                    </div>
                </div>

                <div class="question-card">
                    <div class="question-header">
                        <div class="question-progress">
                            <span class="text-yellow font-semibold">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></span>
                            <span class="text-sm text-gray-400" id="difficultyLabel">Medium</span>
                        </div>
                        <div class="question-category">
                            <i class="fas fa-tag"></i>
                            <span id="questionCategory">General Knowledge</span>
                        </div>
                    </div>
                    
                    <div class="question-text" id="questionText">
                        Loading question...
                    </div>
                    
                    <div class="answers-grid" id="answersContainer">
                        <!-- Answers will be populated here -->
                    </div>
                </div>

                <!-- Buzzer Mode Container (hidden by default) -->
                <div id="buzzerContainer" class="hidden">
                    <div class="buzzer-status">
                        <h3>Buzzer Status</h3>
                        <p id="buzzerInstruction">Wait for the question to be read, then buzz in!</p>
                        <div class="player-buzzed" id="playerBuzzed"></div>
                    </div>
                    <div class="buzzer-container">
                        <button class="buzzer-button buzzer-ready" id="buzzerButton">
                            <i class="fas fa-bolt"></i>
                            <span>BUZZ IN!</span>
                        </button>
                    </div>
                </div>

                <div class="game-controls" id="gameControls">
                    <button class="btn btn-outline" id="hintBtn">
                        <i class="fas fa-lightbulb"></i> Hint (2 left)
                    </button>
                    <button class="btn btn-primary" id="nextQuestionBtn" disabled>
                        Next Question <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-item active" data-screen="home">
            <i class="nav-icon fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="nav-item" data-screen="modes">
            <i class="nav-icon fas fa-gamepad"></i>
            <span>Modes</span>
        </button>
        <button class="nav-item" data-screen="cards">
            <i class="nav-icon fas fa-layer-group"></i>
            <span>Cards</span>
        </button>
        <button class="nav-item" data-screen="profile">
            <i class="nav-icon fas fa-user"></i>
            <span>Profile</span>
        </button>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="gameCompleteModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal('gameCompleteModal')">&times;</button>
                <h2 class="modal-title">Game Complete! 🏆</h2>
                <p class="modal-subtitle">Great game! Here are your results</p>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <div class="text-yellow text-5xl font-bold mb-sm" id="finalScore">0</div>
                    <div class="text-lg mb-lg">Final Score</div>
                    
                    <div class="card mb-lg">
                        <div class="flex justify-around mb-md">
                            <div class="text-center">
                                <div class="text-xl font-bold" id="correctAnswersModal">0</div>
                                <div class="text-sm text-gray-400">Correct</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold" id="timePlayed">0s</div>
                                <div class="text-sm text-gray-400">Time</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold" id="bonusEarned">0</div>
                                <div class="text-sm text-gray-400">Bonus</div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <div class="text-yellow font-semibold mb-sm">Performance Summary</div>
                            <div class="text-sm text-gray-400" id="performanceSummary">
                                You answered 0 out of 0 questions correctly.
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mb-lg">
                        <div class="text-yellow font-semibold mb-sm">Winner</div>
                        <div class="text-2xl font-bold" id="winnerName">Player 1</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="backToMenuBtn">
                    Main Menu
                </button>
                <button class="btn btn-primary" id="playAgainBtn">
                    Play Again
                </button>
            </div>
        </div>
    </div>

    <!-- Create Room Modal -->
    <div class="modal-overlay" id="createRoomModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal('createRoomModal')">&times;</button>
                <h2 class="modal-title">Create Room</h2>
                <p class="modal-subtitle">Set up your online game room</p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Room Name</label>
                    <input type="text" class="form-input" id="roomName" placeholder="Enter room name" maxlength="30">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Game Mode</label>
                    <select class="select-dropdown" id="onlineModeSelect">
                        <!-- Modes will be populated -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Number of Questions</label>
                    <select class="select-dropdown" id="onlineQuestionCount">
                        <option value="5">5 Questions</option>
                        <option value="10" selected>10 Questions</option>
                        <option value="15">15 Questions</option>
                        <option value="20">20 Questions</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="select-dropdown" id="onlineCategorySelect">
                        <!-- Categories will be populated -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Max Players</label>
                    <select class="select-dropdown" id="maxPlayers">
                        <option value="2">2 Players</option>
                        <option value="4" selected>4 Players</option>
                        <option value="6">6 Players</option>
                        <option value="8">8 Players</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createRoomModal')">
                    Cancel
                </button>
                <button class="btn btn-primary" id="createRoomConfirmBtn">
                    Create Room
                </button>
            </div>
        </div>
    </div>

    <!-- Join Room Modal -->
    <div class="modal-overlay" id="joinRoomModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal('joinRoomModal')">&times;</button>
                <h2 class="modal-title">Join Room</h2>
                <p class="modal-subtitle">Enter a room code to join</p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Room Code</label>
                    <input type="text" class="form-input" id="joinRoomCode" placeholder="Enter 6-digit code" maxlength="6" pattern="[A-Z0-9]{6}">
                </div>
                <p class="text-sm text-gray-400 mt-sm">Ask the room host for the 6-digit code</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('joinRoomModal')">
                    Cancel
                </button>
                <button class="btn btn-primary" id="joinRoomConfirmBtn">
                    Join Room
                </button>
            </div>
        </div>
    </div>

    <!-- Mode Details Modal -->
    <div class="modal-overlay" id="modeDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal('modeDetailsModal')">&times;</button>
                <h2 class="modal-title" id="modeDetailsTitle">Classic Mode</h2>
                <p class="modal-subtitle" id="modeDetailsSubtitle">Traditional trivia gameplay</p>
            </div>
            <div class="modal-body">
                <div class="card mb-lg">
                    <h3 class="card-title mb-md">Rules</h3>
                    <div id="modeRules">
                        <!-- Rules will be populated -->
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title mb-md">How to Play</h3>
                    <div id="modeInstructions">
                        <!-- Instructions will be populated -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="playThisModeBtn">
                    <i class="fas fa-play"></i> Play This Mode
                </button>
            </div>
        </div>
    </div>

    <!-- Pause Modal -->
    <div class="modal-overlay" id="pauseModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Game Paused</h2>
                <p class="modal-subtitle">Take a break</p>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fas fa-pause-circle text-yellow text-6xl mb-lg"></i>
                    <p class="text-lg">Game progress will be saved</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('pauseModal')">
                    Resume
                </button>
                <button class="btn btn-primary" id="quitGameBtn">
                    Quit Game
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== GAME STATE =====
        const gameState = {
            // User Profile
            playerName: 'Player',
            playerAvatar: 'P',
            
            // Player Stats
            totalGames: 0,
            totalCorrectAnswers: 0,
            totalQuestions: 0,
            highestStreak: 0,
            totalScore: 0,
            
            // Navigation
            currentScreen: 'home',
            screenHistory: ['home'],
            
            // Players
            players: [],
            currentPlayerIndex: 0,
            
            // Game Modes with unique rules
            gameModes: [
                {
                    id: 'classic',
                    name: 'Classic',
                    icon: 'crown',
                    color: '#6C5CE7',
                    description: 'Traditional question/answer format with progressive difficulty',
                    rules: [
                        '30 seconds per question',
                        '3 lives per player',
                        '100 points per correct answer',
                        'Difficulty increases every 3 questions',
                        'No time bonus'
                    ],
                    instructions: [
                        'Answer questions correctly to earn points',
                        'Wrong answers cost a life',
                        'Complete all questions to win',
                        'Player with highest score wins'
                    ],
                    minPlayers: 2,
                    maxPlayers: 8,
                    timePerQuestion: 30,
                    lives: 3
                },
                {
                    id: 'countdown',
                    name: 'Countdown',
                    icon: 'stopwatch',
                    color: '#FF7675',
                    description: 'Speed bonus for quick answers! Time limits per question',
                    rules: [
                        '15 seconds per question',
                        '3 lives per player',
                        '100 base points + time bonus',
                        'Bonus: Quick answers earn extra points',
                        'Timer counts down, faster answers = more points'
                    ],
                    instructions: [
                        'Answer as quickly as possible',
                        'Bonus points for quick answers',
                        'Wrong answers cost a life',
                        'Speed matters!'
                    ],
                    minPlayers: 2,
                    maxPlayers: 6,
                    timePerQuestion: 15,
                    lives: 3
                },
                {
                    id: 'ladder',
                    name: 'Ladder',
                    icon: 'chart-line',
                    color: '#FDCB6E',
                    description: 'Advance through levels by getting answers correct',
                    rules: [
                        '25 seconds per question',
                        '1 life per player',
                        'Scoring: 100 × current level',
                        'Perfect streak bonus',
                        'Wrong answer = drop back one level'
                    ],
                    instructions: [
                        'Start at level 1',
                        'Correct answer moves up one level',
                        'Wrong answer drops back one level',
                        'Reach the highest level to win'
                    ],
                    minPlayers: 1,
                    maxPlayers: 4,
                    timePerQuestion: 25,
                    lives: 1
                },
                {
                    id: 'battle',
                    name: 'Battle',
                    icon: 'skull-crossbones',
                    color: '#FD79A8',
                    description: 'Elimination-style gameplay! Wrong answers knock players out',
                    rules: [
                        '20 seconds per question',
                        '1 life per player',
                        'Elimination after wrong answer',
                        'Last player standing wins',
                        'Survival bonus points'
                    ],
                    instructions: [
                        'Each player has 1 life',
                        'Wrong answer = eliminated',
                        'Survive to win',
                        'Last player standing wins all'
                    ],
                    minPlayers: 3,
                    maxPlayers: 8,
                    timePerQuestion: 20,
                    lives: 1
                },
                {
                    id: 'buzzer',
                    name: 'Buzzer',
                    icon: 'bolt',
                    color: '#00B894',
                    description: 'First to buzz in answers! Fast-paced competitive play',
                    rules: [
                        'Unlimited time for question',
                        'First to buzz in gets to answer',
                        'Correct answer = points + control',
                        'Wrong answer = lose turn',
                        'Buzz in within 5 seconds of question'
                    ],
                    instructions: [
                        'Listen to the question',
                        'Buzz in first to answer',
                        'Correct answer earns points',
                        'Wrong answer gives others a chance',
                        'Fastest finger wins!'
                    ],
                    minPlayers: 2,
                    maxPlayers: 8,
                    timePerQuestion: 0,
                    lives: 1
                },
                {
                    id: 'solo',
                    name: 'Solo Challenge',
                    icon: 'user-graduate',
                    color: '#00CEC9',
                    description: 'Individual play with deadlines. Perfect for self-challenge!',
                    rules: [
                        '30 seconds per question',
                        '3 lives',
                        'Score + accuracy bonus',
                        'Perfect round bonus',
                        'Beat your high score!'
                    ],
                    instructions: [
                        'Play against yourself',
                        'Aim for high score',
                        'Perfect rounds earn bonus',
                        'Track your progress'
                    ],
                    minPlayers: 1,
                    maxPlayers: 1,
                    timePerQuestion: 30,
                    lives: 3
                }
            ],
            
            // Categories
            categories: [
                {
                    id: 'general',
                    name: 'General Knowledge',
                    icon: 'brain',
                    color: '#6C5CE7',
                    description: 'A mix of everything from science to pop culture'
                },
                {
                    id: 'science',
                    name: 'Science',
                    icon: 'flask',
                    color: '#FF7675',
                    description: 'Biology, chemistry, physics, and astronomy'
                },
                {
                    id: 'history',
                    name: 'History',
                    icon: 'landmark',
                    color: '#FDCB6E',
                    description: 'World history, famous events, and historical figures'
                },
                {
                    id: 'entertainment',
                    name: 'Entertainment',
                    icon: 'film',
                    color: '#FD79A8',
                    description: 'Movies, TV shows, music, and celebrities'
                },
                {
                    id: 'sports',
                    name: 'Sports',
                    icon: 'football-ball',
                    color: '#00B894',
                    description: 'All things sports - teams, players, and events'
                },
                {
                    id: 'geography',
                    name: 'Geography',
                    icon: 'globe',
                    color: '#00CEC9',
                    description: 'Countries, capitals, landmarks, and maps'
                },
                {
                    id: 'arts',
                    name: 'Arts & Literature',
                    icon: 'palette',
                    color: '#9B59B6',
                    description: 'Books, authors, paintings, and artists'
                },
                {
                    id: 'technology',
                    name: 'Technology',
                    icon: 'laptop-code',
                    color: '#3498DB',
                    description: 'Computers, internet, and tech innovations'
                }
            ],
            
            // Current Game State
            isGameActive: false,
            isOnlineGame: false,
            currentGameMode: null,
            currentQuestionIndex: 0,
            totalQuestions: 10,
            score: 0,
            lives: 3,
            timeBonus: 0,
            timer: 30,
            timerInterval: null,
            gameStartTime: null,
            correctAnswers: 0,
            selectedCategory: 'general',
            selectedDifficulty: 'medium',
            currentStreak: 0,
            maxStreak: 0,
            currentQuestion: null,
            currentAnswers: [],
            selectedAnswer: null,
            
            // Online State
            roomCode: null,
            roomName: null,
            isHost: false,
            onlinePlayers: [],
            socket: null,
            
            // Achievements
            achievements: [
                { id: 'first_game', name: 'First Timer', description: 'Complete your first game', unlocked: false },
                { id: 'perfect_game', name: 'Perfectionist', description: 'Get all questions correct in a game', unlocked: false },
                { id: 'streak_10', name: 'Hot Streak', description: 'Answer 10 questions in a row correctly', unlocked: false },
                { id: 'speed_demon', name: 'Speed Demon', description: 'Answer a question in under 3 seconds', unlocked: false },
                { id: 'mode_master', name: 'Mode Master', description: 'Play all game modes', unlocked: false },
                { id: 'category_expert', name: 'Category Expert', description: 'Play all categories', unlocked: false }
            ]
        };

        // ===== API CONFIGURATION =====
        const API_CONFIG = {
            BASE_URL: 'https://the-trivia-api.com/v2',
            API_KEY: 'https://the-trivia-api.com/v2/questions', // Using the provided endpoint as API key
            CATEGORIES: {
                'general': 'general_knowledge',
                'science': 'science',
                'history': 'history',
                'entertainment': 'film_and_tv',
                'sports': 'sport_and_leisure',
                'geography': 'geography',
                'arts': 'arts_and_literature',
                'technology': 'science' // Using science as fallback
            }
        };

        // ===== DOM ELEMENTS =====
        const elements = {
            // Loading
            loadingScreen: document.getElementById('loadingScreen'),
            loadingProgress: document.getElementById('loadingProgress'),
            loadingText: document.getElementById('loadingText'),
            
            // Player HUD
            playerName: document.getElementById('playerName'),
            playerScoreHud: document.getElementById('playerScoreHud'),
            
            // Bottom Navigation
            navItems: document.querySelectorAll('.nav-item'),
            
            // Screens
            screens: {
                home: document.getElementById('homeScreen'),
                modes: document.getElementById('modesScreen'),
                cards: document.getElementById('cardsScreen'),
                profile: document.getElementById('profileScreen'),
                play: document.getElementById('playScreen'),
                online: document.getElementById('onlineScreen'),
                waiting: document.getElementById('waitingScreen'),
                game: document.getElementById('gameScreen')
            },
            
            // Setup Screen
            playersList: document.getElementById('playersList'),
            finalPlayersList: document.getElementById('finalPlayersList'),
            playerNameInput: document.getElementById('playerNameInput'),
            addPlayerBtn: document.getElementById('addPlayerBtn'),
            modesGrid: document.getElementById('modesGrid'),
            selectedModeName: document.getElementById('selectedModeName'),
            selectedModeDescription: document.getElementById('selectedModeDescription'),
            
            // Step Navigation
            nextStepBtn: document.getElementById('nextStepBtn'),
            nextStepBtn2: document.getElementById('nextStepBtn2'),
            prevStepBtn: document.getElementById('prevStepBtn'),
            prevStepBtn2: document.getElementById('prevStepBtn2'),
            startGameBtn: document.getElementById('startGameBtn'),
            
            // Game Settings
            questionCount: document.getElementById('questionCount'),
            categorySelect: document.getElementById('categorySelect'),
            difficultySelect: document.getElementById('difficultySelect'),
            settingsQuestionCount: document.getElementById('settingsQuestionCount'),
            settingsCategory: document.getElementById('settingsCategory'),
            settingsDifficulty: document.getElementById('settingsDifficulty'),
            setupModeTitle: document.getElementById('setupModeTitle'),
            setupModeDescription: document.getElementById('setupModeDescription'),
            
            // Game Screen
            playerScore: document.getElementById('playerScore'),
            currentQuestionNum: document.getElementById('currentQuestionNum'),
            playerLives: document.getElementById('playerLives'),
            timeBonus: document.getElementById('timeBonus'),
            modeName: document.getElementById('modeName'),
            currentGameMode: document.getElementById('currentGameMode'),
            gameTimer: document.getElementById('gameTimer'),
            currentQuestion: document.getElementById('currentQuestion'),
            totalQuestions: document.getElementById('totalQuestions'),
            difficultyLabel: document.getElementById('difficultyLabel'),
            questionCategory: document.getElementById('questionCategory'),
            questionText: document.getElementById('questionText'),
            answersContainer: document.getElementById('answersContainer'),
            hintBtn: document.getElementById('hintBtn'),
            nextQuestionBtn: document.getElementById('nextQuestionBtn'),
            gameControls: document.getElementById('gameControls'),
            
            // Buzzer Mode
            buzzerContainer: document.getElementById('buzzerContainer'),
            buzzerButton: document.getElementById('buzzerButton'),
            buzzerInstruction: document.getElementById('buzzerInstruction'),
            playerBuzzed: document.getElementById('playerBuzzed'),
            
            // Online Screen
            createRoomBtn: document.getElementById('createRoomBtn'),
            joinRoomBtn: document.getElementById('joinRoomBtn'),
            refreshRoomsBtn: document.getElementById('refreshRoomsBtn'),
            roomList: document.getElementById('roomList'),
            
            // Waiting Room
            roomCodeDisplay: document.getElementById('roomCodeDisplay'),
            onlinePlayersList: document.getElementById('onlinePlayersList'),
            roomMode: document.getElementById('roomMode'),
            roomQuestions: document.getElementById('roomQuestions'),
            roomCategory: document.getElementById('roomCategory'),
            leaveRoomBtn: document.getElementById('leaveRoomBtn'),
            startOnlineGameBtn: document.getElementById('startOnlineGameBtn'),
            
            // Profile Screen
            profileAvatar: document.getElementById('profileAvatar'),
            profileName: document.getElementById('profileName'),
            totalGames: document.getElementById('totalGames'),
            correctAnswers: document.getElementById('correctAnswers'),
            highestStreak: document.getElementById('highestStreak'),
            totalScore: document.getElementById('totalScore'),
            achievementsList: document.getElementById('achievementsList'),
            
            // Categories Screen
            categoriesGrid: document.getElementById('categoriesGrid'),
            
            // Modal
            gameCompleteModal: document.getElementById('gameCompleteModal'),
            finalScore: document.getElementById('finalScore'),
            correctAnswersModal: document.getElementById('correctAnswersModal'),
            timePlayed: document.getElementById('timePlayed'),
            bonusEarned: document.getElementById('bonusEarned'),
            winnerName: document.getElementById('winnerName'),
            performanceSummary: document.getElementById('performanceSummary'),
            backToMenuBtn: document.getElementById('backToMenuBtn'),
            playAgainBtn: document.getElementById('playAgainBtn'),
            
            // Create Room Modal
            createRoomModal: document.getElementById('createRoomModal'),
            roomName: document.getElementById('roomName'),
            onlineModeSelect: document.getElementById('onlineModeSelect'),
            onlineQuestionCount: document.getElementById('onlineQuestionCount'),
            onlineCategorySelect: document.getElementById('onlineCategorySelect'),
            maxPlayers: document.getElementById('maxPlayers'),
            createRoomConfirmBtn: document.getElementById('createRoomConfirmBtn'),
            
            // Join Room Modal
            joinRoomModal: document.getElementById('joinRoomModal'),
            joinRoomCode: document.getElementById('joinRoomCode'),
            joinRoomConfirmBtn: document.getElementById('joinRoomConfirmBtn'),
            
            // Mode Details Modal
            modeDetailsModal: document.getElementById('modeDetailsModal'),
            modeDetailsTitle: document.getElementById('modeDetailsTitle'),
            modeDetailsSubtitle: document.getElementById('modeDetailsSubtitle'),
            modeRules: document.getElementById('modeRules'),
            modeInstructions: document.getElementById('modeInstructions'),
            playThisModeBtn: document.getElementById('playThisModeBtn'),
            
            // Pause Modal
            pauseModal: document.getElementById('pauseModal'),
            quitGameBtn: document.getElementById('quitGameBtn')
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setupEventListeners();
            simulateLoading();
        });

        async function initializeApp() {
            // Load saved data from localStorage
            loadSavedData();
            
            // Update UI
            updateHUD();
            populateGameData();
            populateCategories();
            setupStepNavigation();
            
            // Initialize online mode selectors
            populateOnlineSelectors();
        }

        function loadSavedData() {
            const savedName = localStorage.getItem('playerName');
            const savedAvatar = localStorage.getItem('playerAvatar');
            
            if (savedName) {
                gameState.playerName = savedName;
                gameState.playerAvatar = savedAvatar || 'P';
            }
            
            // Load stats
            gameState.totalGames = parseInt(localStorage.getItem('totalGames')) || 0;
            gameState.totalCorrectAnswers = parseInt(localStorage.getItem('totalCorrectAnswers')) || 0;
            gameState.totalQuestions = parseInt(localStorage.getItem('totalQuestions')) || 0;
            gameState.highestStreak = parseInt(localStorage.getItem('highestStreak')) || 0;
            gameState.totalScore = parseInt(localStorage.getItem('totalScore')) || 0;
            
            // Load achievements
            const savedAchievements = localStorage.getItem('achievements');
            if (savedAchievements) {
                gameState.achievements = JSON.parse(savedAchievements);
            }
        }

        function saveData() {
            localStorage.setItem('playerName', gameState.playerName);
            localStorage.setItem('playerAvatar', gameState.playerAvatar);
            localStorage.setItem('totalGames', gameState.totalGames);
            localStorage.setItem('totalCorrectAnswers', gameState.totalCorrectAnswers);
            localStorage.setItem('totalQuestions', gameState.totalQuestions);
            localStorage.setItem('highestStreak', gameState.highestStreak);
            localStorage.setItem('totalScore', gameState.totalScore);
            localStorage.setItem('achievements', JSON.stringify(gameState.achievements));
        }

        function simulateLoading() {
            let progress = 0;
            const messages = [
                "Loading game assets...",
                "Initializing game engine...",
                "Preparing questions database...",
                "Setting up multiplayer...",
                "Almost ready..."
            ];
            
            const interval = setInterval(() => {
                progress += 20;
                elements.loadingProgress.style.width = `${progress}%`;
                
                // Update loading text
                if (progress < 25) elements.loadingText.textContent = messages[0];
                else if (progress < 50) elements.loadingText.textContent = messages[1];
                else if (progress < 75) elements.loadingText.textContent = messages[2];
                else if (progress < 90) elements.loadingText.textContent = messages[3];
                else elements.loadingText.textContent = messages[4];
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        elements.loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            elements.loadingScreen.style.display = 'none';
                        }, 500);
                    }, 500);
                }
            }, 200);
        }

        function updateHUD() {
            elements.playerName.textContent = gameState.playerName;
            elements.playerScoreHud.textContent = gameState.totalScore.toLocaleString();
        }

        function updateProfile() {
            elements.profileName.textContent = gameState.playerName;
            elements.profileAvatar.textContent = gameState.playerAvatar;
            
            // Calculate stats
            const accuracy = gameState.totalQuestions > 0 ? 
                Math.round((gameState.totalCorrectAnswers / gameState.totalQuestions) * 100) : 0;
            
            elements.totalGames.textContent = gameState.totalGames;
            elements.correctAnswers.textContent = `${accuracy}%`;
            elements.highestStreak.textContent = gameState.highestStreak;
            elements.totalScore.textContent = gameState.totalScore.toLocaleString();
            
            // Update achievements
            updateAchievementsDisplay();
        }

        function updateAchievementsDisplay() {
            elements.achievementsList.innerHTML = gameState.achievements.map(achievement => `
                <div class="player-item ${achievement.unlocked ? '' : 'opacity-50'}">
                    <div class="flex items-center gap-md">
                        <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center">
                            <i class="fas ${achievement.unlocked ? 'fa-trophy text-yellow' : 'fa-lock text-gray-400'}"></i>
                        </div>
                        <div>
                            <div class="player-name">${achievement.name}</div>
                            <div class="text-xs text-gray-400">${achievement.description}</div>
                        </div>
                    </div>
                    ${achievement.unlocked ? '<span class="text-yellow text-sm"><i class="fas fa-check"></i> Unlocked</span>' : ''}
                </div>
            `).join('');
        }

        function populateGameData() {
            // Populate game modes grid
            if (elements.modesGrid) {
                elements.modesGrid.innerHTML = gameState.gameModes.map(mode => `
                    <div class="card mode-card" data-mode="${mode.id}">
                        <div class="card-icon" style="background: rgba(${hexToRgb(mode.color)}, 0.2); color: ${mode.color};">
                            <i class="fas fa-${mode.icon}"></i>
                        </div>
                        <h3 class="card-title">${mode.name}</h3>
                        <p class="card-description">${mode.description}</p>
                        <div class="flex justify-between items-center mt-md">
                            <span class="text-sm text-gray-400">${mode.minPlayers}-${mode.maxPlayers} Players</span>
                            <div class="flex gap-sm">
                                <button class="btn btn-outline btn-sm view-mode-btn" data-mode="${mode.id}">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                                <button class="btn btn-primary btn-sm play-mode-btn" data-mode="${mode.id}">
                                    Play
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            // Add sample players for demo
            addPlayer('Player 1');
            addPlayer('Player 2');
        }

        function populateCategories() {
            // Populate categories for setup screen
            if (elements.categorySelect) {
                elements.categorySelect.innerHTML = gameState.categories.map(category => `
                    <option value="${category.id}">${category.name}</option>
                `).join('');
            }
            
            // Populate categories screen
            if (elements.categoriesGrid) {
                elements.categoriesGrid.innerHTML = gameState.categories.map(category => `
                    <div class="card category-card" data-category="${category.id}">
                        <div class="card-icon" style="background: rgba(${hexToRgb(category.color)}, 0.2); color: ${category.color};">
                            <i class="fas fa-${category.icon}"></i>
                        </div>
                        <h3 class="card-title">${category.name}</h3>
                        <p class="card-description">${category.description}</p>
                        <div class="category-progress">
                            <span class="text-sm text-gray-400">Played: 0 times</span>
                            <button class="btn btn-outline btn-sm play-category-btn" data-category="${category.id}">
                                Play
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function populateOnlineSelectors() {
            // Populate online mode selector
            if (elements.onlineModeSelect) {
                elements.onlineModeSelect.innerHTML = gameState.gameModes.map(mode => `
                    <option value="${mode.id}">${mode.name}</option>
                `).join('');
            }
            
            // Populate online category selector
            if (elements.onlineCategorySelect) {
                elements.onlineCategorySelect.innerHTML = gameState.categories.map(category => `
                    <option value="${category.id}">${category.name}</option>
                `).join('');
            }
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r}, ${g}, ${b}`;
        }

        // ===== NAVIGATION =====
        function updateNavigation(screenId) {
            // Update screen history
            if (screenId !== gameState.currentScreen) {
                gameState.screenHistory.push(screenId);
                gameState.currentScreen = screenId;
            }
            
            // Update bottom navigation
            elements.navItems.forEach(item => {
                item.classList.remove('active');
                if (item.dataset.screen === screenId) {
                    item.classList.add('active');
                }
            });
            
            // Update URL hash
            window.location.hash = screenId;
            
            // Hide all screens
            Object.values(elements.screens).forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show current screen
            if (elements.screens[screenId]) {
                elements.screens[screenId].classList.add('active');
            }
            
            // Update specific screens
            if (screenId === 'profile') {
                updateProfile();
            } else if (screenId === 'cards') {
                populateCategories();
            }
        }

        function goBack() {
            if (gameState.screenHistory.length > 1) {
                gameState.screenHistory.pop(); // Remove current
                const previousScreen = gameState.screenHistory.pop(); // Get previous
                if (previousScreen) {
                    updateNavigation(previousScreen);
                }
            }
        }

        // ===== PLAYER MANAGEMENT =====
        function addPlayer(name) {
            if (!name.trim()) return;
            
            const playerName = name.trim().substring(0, 20);
            
            if (!gameState.players.includes(playerName)) {
                gameState.players.push(playerName);
                updatePlayersList();
            }
            
            elements.playerNameInput.value = '';
            elements.playerNameInput.focus();
        }

        function removePlayer(name) {
            gameState.players = gameState.players.filter(p => p !== name);
            updatePlayersList();
        }

        function updatePlayersList() {
            const list = elements.playersList;
            
            if (gameState.players.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 py-8">No players added yet</div>';
                return;
            }
            
            list.innerHTML = gameState.players.map((player, index) => `
                <div class="player-item">
                    <div class="flex items-center gap-md">
                        <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center font-bold">
                            ${index + 1}
                        </div>
                        <div class="player-name">${player}</div>
                    </div>
                    <button class="text-gray-400 hover:text-red-400 remove-player-btn" data-player="${player}">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        // ===== GAME SETUP =====
        function setupStepNavigation() {
            const steps = document.querySelectorAll('.step');
            const sections = document.querySelectorAll('.setup-section');
            
            // Show step 1 by default
            steps.forEach(step => step.classList.remove('active'));
            sections.forEach(section => section.classList.remove('active'));
            
            steps[0].classList.add('active');
            sections[0].classList.add('active');
        }

        function navigateToStep(stepNumber) {
            const steps = document.querySelectorAll('.step');
            const sections = document.querySelectorAll('.setup-section');
            
            // Update steps
            steps.forEach((step, index) => {
                step.classList.remove('active');
                if (index + 1 === stepNumber) {
                    step.classList.add('active');
                }
            });
            
            // Update sections
            sections.forEach((section, index) => {
                section.classList.remove('active');
                if (index + 1 === stepNumber) {
                    section.classList.add('active');
                }
            });
            
            // Update final players list and settings
            if (stepNumber === 3) {
                updateFinalPlayersList();
                updateSelectedMode();
                updateSettingsDisplay();
            }
        }

        function updateFinalPlayersList() {
            const list = elements.finalPlayersList;
            list.innerHTML = gameState.players.map((player, index) => `
                <div class="player-item">
                    <div class="flex items-center gap-md">
                        <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center font-bold">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="player-name">${player}</div>
                            <div class="text-xs text-gray-400">Ready to play</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateSelectedMode() {
            const mode = gameState.gameModes.find(m => m.id === gameState.currentGameMode);
            if (mode) {
                elements.selectedModeName.textContent = mode.name;
                elements.selectedModeDescription.textContent = mode.description;
                
                // Update setup screen title
                elements.setupModeTitle.textContent = `${mode.name} Setup`;
                elements.setupModeDescription.textContent = mode.description;
            }
        }

        function updateSettingsDisplay() {
            elements.settingsQuestionCount.textContent = elements.questionCount.value;
            elements.settingsCategory.textContent = elements.categorySelect.options[elements.categorySelect.selectedIndex].text;
            elements.settingsDifficulty.textContent = elements.difficultySelect.options[elements.difficultySelect.selectedIndex].text;
        }

        // ===== QUESTION MANAGEMENT =====
        async function fetchQuestions(category, difficulty, limit) {
            try {
                const apiCategory = API_CONFIG.CATEGORIES[category] || 'general_knowledge';
                
                // Build URL with parameters
                const url = new URL(API_CONFIG.BASE_URL + '/questions');
                url.searchParams.append('limit', limit);
                url.searchParams.append('categories', apiCategory);
                url.searchParams.append('difficulties', difficulty);
                
                console.log('Fetching questions from:', url.toString());
                
                const response = await fetch(url.toString());
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Transform API data to our format
                return data.map(q => ({
                    question: q.question.text,
                    answers: [
                        { text: q.correctAnswer, correct: true },
                        ...q.incorrectAnswers.map(ans => ({ text: ans, correct: false }))
                    ].sort(() => Math.random() - 0.5), // Shuffle answers
                    category: category,
                    difficulty: q.difficulty || difficulty
                }));
                
            } catch (error) {
                console.error('Error fetching questions:', error);
                
                // Fallback to local questions if API fails
                return getLocalQuestions(category, limit);
            }
        }

        function getLocalQuestions(category, limit) {
            // Local fallback questions
            const localQuestions = {
                general: [
                    {
                        question: "What is the capital of France?",
                        answers: [
                            { text: "London", correct: false },
                            { text: "Paris", correct: true },
                            { text: "Berlin", correct: false },
                            { text: "Madrid", correct: false }
                        ],
                        difficulty: "easy"
                    },
                    {
                        question: "How many continents are there?",
                        answers: [
                            { text: "5", correct: false },
                            { text: "6", correct: false },
                            { text: "7", correct: true },
                            { text: "8", correct: false }
                        ],
                        difficulty: "easy"
                    }
                ],
                science: [
                    {
                        question: "What is the chemical symbol for water?",
                        answers: [
                            { text: "H2O", correct: true },
                            { text: "CO2", correct: false },
                            { text: "O2", correct: false },
                            { text: "NaCl", correct: false }
                        ],
                        difficulty: "easy"
                    }
                ]
            };
            
            const questions = localQuestions[category] || localQuestions.general;
            return questions.slice(0, limit);
        }

        // ===== GAME MODE FUNCTIONS =====
        async function startGame() {
            if (!gameState.currentGameMode) {
                alert('Please select a game mode');
                return;
            }
            
            if (gameState.players.length < 2 && gameState.currentGameMode !== 'solo') {
                alert(`Need at least ${gameState.currentGameMode === 'battle' ? '3' : '2'} players to start`);
                return;
            }
            
            // Get selected mode
            const mode = gameState.gameModes.find(m => m.id === gameState.currentGameMode);
            
            // Reset game state based on mode
            gameState.isGameActive = true;
            gameState.currentQuestionIndex = 0;
            gameState.score = 0;
            gameState.lives = mode.lives;
            gameState.timeBonus = 0;
            gameState.timer = mode.timePerQuestion;
            gameState.correctAnswers = 0;
            gameState.currentStreak = 0;
            gameState.maxStreak = 0;
            gameState.gameStartTime = Date.now();
            
            // Get game settings
            gameState.totalQuestions = parseInt(elements.questionCount.value);
            gameState.selectedCategory = elements.categorySelect.value;
            gameState.selectedDifficulty = elements.difficultySelect.value;
            
            // Update UI
            elements.modeName.textContent = mode.name;
            elements.currentGameMode.innerHTML = `<i class="fas fa-${mode.icon}"></i> <span>${mode.name}</span>`;
            elements.playerScore.textContent = '0';
            elements.playerScoreHud.textContent = '0';
            elements.playerLives.textContent = gameState.lives;
            elements.timeBonus.textContent = '0';
            elements.currentQuestionNum.textContent = `1/${gameState.totalQuestions}`;
            elements.totalQuestions.textContent = gameState.totalQuestions;
            
            // Show/hide buzzer container based on mode
            if (gameState.currentGameMode === 'buzzer') {
                elements.buzzerContainer.classList.remove('hidden');
                elements.gameControls.classList.add('hidden');
            } else {
                elements.buzzerContainer.classList.add('hidden');
                elements.gameControls.classList.remove('hidden');
            }
            
            // Navigate to game screen
            updateNavigation('game');
            
            // Fetch and load first question
            await loadQuestion();
        }

        async function loadQuestion() {
            if (gameState.currentQuestionIndex >= gameState.totalQuestions) {
                endGame();
                return;
            }
            
            // Show loading state
            elements.questionText.textContent = 'Loading question...';
            elements.answersContainer.innerHTML = '<div class="text-center py-8">Loading...</div>';
            
            try {
                // Fetch questions for the current category
                const questions = await fetchQuestions(
                    gameState.selectedCategory,
                    gameState.selectedDifficulty,
                    gameState.totalQuestions
                );
                
                if (!questions || questions.length === 0) {
                    throw new Error('No questions available');
                }
                
                const question = questions[gameState.currentQuestionIndex];
                gameState.currentQuestion = question;
                
                // Update UI
                elements.currentQuestion.textContent = gameState.currentQuestionIndex + 1;
                elements.currentQuestionNum.textContent = `${gameState.currentQuestionIndex + 1}/${gameState.totalQuestions}`;
                
                const category = gameState.categories.find(c => c.id === gameState.selectedCategory);
                elements.questionCategory.textContent = category ? category.name : 'General Knowledge';
                
                elements.difficultyLabel.textContent = question.difficulty.charAt(0).toUpperCase() + question.difficulty.slice(1);
                elements.questionText.textContent = question.question;
                
                // Clear and populate answers
                elements.answersContainer.innerHTML = '';
                const letters = ['A', 'B', 'C', 'D'];
                
                // Make sure we have exactly 4 answers
                const answers = [...question.answers];
                while (answers.length < 4) {
                    answers.push({ text: `Answer ${answers.length + 1}`, correct: false });
                }
                
                // Shuffle answers
                const shuffledAnswers = answers.sort(() => Math.random() - 0.5);
                
                shuffledAnswers.forEach((answer, index) => {
                    const answerElement = document.createElement('div');
                    answerElement.className = 'answer-option';
                    answerElement.innerHTML = `
                        <div class="answer-letter">${letters[index]}</div>
                        <div class="flex-1">${answer.text}</div>
                    `;
                    answerElement.onclick = () => selectAnswer(answer.correct, answerElement, question.difficulty);
                    elements.answersContainer.appendChild(answerElement);
                });
                
                // Reset controls
                elements.nextQuestionBtn.disabled = true;
                elements.hintBtn.disabled = false;
                elements.hintBtn.innerHTML = '<i class="fas fa-lightbulb"></i> Hint (2 left)';
                
                // Reset buzzer if in buzzer mode
                if (gameState.currentGameMode === 'buzzer') {
                    elements.buzzerButton.className = 'buzzer-button buzzer-ready';
                    elements.buzzerButton.disabled = false;
                    elements.buzzerInstruction.textContent = 'Wait for the question to be read, then buzz in!';
                    elements.playerBuzzed.textContent = '';
                }
                
                // Start timer with mode-specific settings
                if (gameState.currentGameMode !== 'buzzer') {
                    startQuestionTimer();
                }
                
            } catch (error) {
                console.error('Error loading question:', error);
                showFeedback('Error loading question. Please try again.', 'incorrect');
                
                // Try again after delay
                setTimeout(() => loadQuestion(), 2000);
            }
        }

        function selectAnswer(isCorrect, element, difficulty) {
            if (!gameState.isGameActive) return;
            
            // Disable all answers
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            // Calculate base score based on difficulty
            let baseScore = 100;
            if (difficulty === 'medium') baseScore = 150;
            if (difficulty === 'hard') baseScore = 200;
            
            // Apply mode-specific scoring
            let pointsEarned = baseScore;
            const mode = gameState.gameModes.find(m => m.id === gameState.currentGameMode);
            
            switch (gameState.currentGameMode) {
                case 'classic':
                    // Progressive difficulty bonus
                    const difficultyBonus = Math.floor(gameState.currentQuestionIndex / 3) * 25;
                    pointsEarned += difficultyBonus;
                    break;
                    
                case 'countdown':
                    // Time bonus: up to 50 extra points for quick answers
                    const timeRemaining = parseInt(elements.gameTimer.textContent);
                    const timeBonus = Math.max(0, Math.floor((gameState.timer - timeRemaining) / 3) * 5);
                    pointsEarned += timeBonus;
                    gameState.timeBonus += timeBonus;
                    elements.timeBonus.textContent = gameState.timeBonus;
                    break;
                    
                case 'ladder':
                    // Level-based scoring (current level = streak + 1)
                    pointsEarned *= (gameState.currentStreak + 1);
                    break;
                    
                case 'battle':
                    // Elimination bonus
                    pointsEarned += gameState.players.length * 20;
                    break;
                    
                case 'buzzer':
                    // Buzzer mode points
                    pointsEarned += 50; // Bonus for buzzing in first
                    break;
                    
                case 'solo':
                    // Accuracy bonus
                    const accuracyBonus = Math.floor((gameState.correctAnswers / (gameState.currentQuestionIndex + 1)) * 50);
                    pointsEarned += accuracyBonus;
                    break;
            }
            
            // Update streak
            if (isCorrect) {
                gameState.currentStreak++;
                gameState.maxStreak = Math.max(gameState.maxStreak, gameState.currentStreak);
            } else {
                gameState.currentStreak = 0;
            }
            
            // Mark correct/incorrect
            if (isCorrect) {
                element.classList.add('selected');
                gameState.score += pointsEarned;
                gameState.correctAnswers++;
                
                // Update score display
                elements.playerScore.textContent = gameState.score;
                elements.playerScoreHud.textContent = gameState.score;
                
                // Show correct feedback
                showFeedback(`+${pointsEarned} points!`, 'correct');
            } else {
                element.classList.add('incorrect');
                gameState.lives--;
                elements.playerLives.textContent = gameState.lives;
                
                // Mark correct answer
                const correctAnswer = gameState.currentQuestion.answers.find(a => a.correct);
                if (correctAnswer) {
                    document.querySelectorAll('.answer-option').forEach(opt => {
                        const answerText = opt.querySelector('.flex-1').textContent;
                        if (answerText === correctAnswer.text) {
                            opt.classList.add('selected');
                        }
                    });
                }
                
                // Show incorrect feedback
                showFeedback(`-1 life`, 'incorrect');
            }
            
            // Stop timer
            clearInterval(gameState.timerInterval);
            
            // Enable next button
            elements.nextQuestionBtn.disabled = false;
            
            // Check if game over
            if (gameState.lives <= 0) {
                setTimeout(() => endGame(), 1500);
            }
        }

        function showFeedback(message, type) {
            const feedback = document.createElement('div');
            feedback.className = `feedback-message feedback-${type}`;
            feedback.textContent = message;
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 1500);
        }

        function startQuestionTimer() {
            clearInterval(gameState.timerInterval);
            
            let timeLeft = gameState.timer;
            updateTimerDisplay(timeLeft);
            
            gameState.timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay(timeLeft);
                
                if (timeLeft <= 0) {
                    clearInterval(gameState.timerInterval);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay(timeLeft) {
            elements.gameTimer.textContent = `${timeLeft}s`;
            
            // Visual feedback for low time
            if (timeLeft <= 10) {
                elements.gameTimer.style.color = 'var(--red)';
            } else if (timeLeft <= 20) {
                elements.gameTimer.style.color = 'var(--orange)';
            } else {
                elements.gameTimer.style.color = 'var(--yellow)';
            }
        }

        function timeUp() {
            // Disable all answers
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            // Mark correct answer
            const correctAnswer = gameState.currentQuestion.answers.find(a => a.correct);
            if (correctAnswer) {
                document.querySelectorAll('.answer-option').forEach(opt => {
                    const answerText = opt.querySelector('.flex-1').textContent;
                    if (answerText === correctAnswer.text) {
                        opt.classList.add('selected');
                    }
                });
            }
            
            // Mode-specific time up penalties
            switch (gameState.currentGameMode) {
                case 'countdown':
                    // No lives lost, just no points
                    break;
                case 'ladder':
                    // Lose a level on time up
                    if (gameState.currentStreak > 0) {
                        gameState.currentStreak = Math.max(0, gameState.currentStreak - 1);
                    }
                    break;
                default:
                    // Lose a life for most modes
                    if (gameState.currentGameMode !== 'buzzer') {
                        gameState.lives--;
                        elements.playerLives.textContent = gameState.lives;
                    }
                    break;
            }
            
            // Enable next button
            elements.nextQuestionBtn.disabled = false;
            
            // Check if game over
            if (gameState.lives <= 0) {
                setTimeout(() => endGame(), 1500);
            }
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            
            if (gameState.currentQuestionIndex >= gameState.totalQuestions) {
                endGame();
                return;
            }
            
            // Load next question
            loadQuestion();
        }

        function endGame() {
            gameState.isGameActive = false;
            clearInterval(gameState.timerInterval);
            
            // Calculate final stats
            const timePlayed = Math.floor((Date.now() - gameState.gameStartTime) / 1000);
            const accuracy = gameState.totalQuestions > 0 ? 
                Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100) : 0;
            
            // Determine winner
            let winner = gameState.playerName;
            if (gameState.players.length > 0) {
                // In a real implementation, you'd track scores per player
                winner = gameState.players[0];
            }
            
            // Update player stats
            gameState.totalGames++;
            gameState.totalCorrectAnswers += gameState.correctAnswers;
            gameState.totalQuestions += gameState.totalQuestions;
            gameState.totalScore += gameState.score;
            
            if (gameState.maxStreak > gameState.highestStreak) {
                gameState.highestStreak = gameState.maxStreak;
            }
            
            // Check achievements
            checkAchievements();
            
            // Save updated data
            saveData();
            
            // Update modal
            elements.finalScore.textContent = gameState.score.toLocaleString();
            elements.correctAnswersModal.textContent = `${gameState.correctAnswers}/${gameState.totalQuestions}`;
            elements.timePlayed.textContent = `${timePlayed}s`;
            elements.bonusEarned.textContent = gameState.timeBonus;
            elements.winnerName.textContent = winner;
            elements.performanceSummary.textContent = 
                `Accuracy: ${accuracy}% | Longest Streak: ${gameState.maxStreak}`;
            
            // Update HUD
            updateHUD();
            
            // Show modal
            openModal('gameCompleteModal');
        }

        // ===== ACHIEVEMENTS =====
        function checkAchievements() {
            // First game
            if (gameState.totalGames === 1) {
                unlockAchievement('first_game');
            }
            
            // Perfect game
            if (gameState.correctAnswers === gameState.totalQuestions && gameState.totalQuestions > 0) {
                unlockAchievement('perfect_game');
            }
            
            // Streak of 10
            if (gameState.maxStreak >= 10) {
                unlockAchievement('streak_10');
            }
        }

        function unlockAchievement(achievementId) {
            const achievement = gameState.achievements.find(a => a.id === achievementId);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                showFeedback(`Achievement Unlocked: ${achievement.name}!`, 'correct');
            }
        }

        // ===== MODAL FUNCTIONS =====
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // ===== ONLINE MULTIPLAYER =====
        function createRoom() {
            const roomName = elements.roomName.value.trim() || `${gameState.playerName}'s Room`;
            const modeId = elements.onlineModeSelect.value;
            const questions = elements.onlineQuestionCount.value;
            const categoryId = elements.onlineCategorySelect.value;
            const maxPlayers = elements.maxPlayers.value;
            
            // Generate room code
            gameState.roomCode = generateRoomCode();
            gameState.roomName = roomName;
            gameState.currentGameMode = modeId;
            gameState.totalQuestions = parseInt(questions);
            gameState.selectedCategory = categoryId;
            gameState.isHost = true;
            gameState.isOnlineGame = true;
            
            // Clear players and add host
            gameState.players = [gameState.playerName];
            gameState.onlinePlayers = [{ name: gameState.playerName, isHost: true }];
            
            // Update waiting room
            elements.roomCodeDisplay.textContent = gameState.roomCode;
            elements.roomMode.textContent = gameState.gameModes.find(m => m.id === modeId).name;
            elements.roomQuestions.textContent = questions;
            elements.roomCategory.textContent = gameState.categories.find(c => c.id === categoryId).name;
            
            // Update online players list
            updateOnlinePlayersList();
            
            // Close modal and go to waiting room
            closeModal('createRoomModal');
            updateNavigation('waiting');
            
            // Simulate other players joining (for demo)
            setTimeout(() => simulatePlayerJoin('Player 2'), 2000);
            setTimeout(() => simulatePlayerJoin('Player 3'), 4000);
        }

        function joinRoom() {
            const roomCode = elements.joinRoomCode.value.trim().toUpperCase();
            
            if (!roomCode || roomCode.length !== 6) {
                alert('Please enter a valid 6-digit room code');
                return;
            }
            
            // For demo purposes, simulate joining
            gameState.roomCode = roomCode;
            gameState.roomName = `Room ${roomCode}`;
            gameState.isHost = false;
            gameState.isOnlineGame = true;
            
            // Add player to room
            gameState.players = [gameState.playerName];
            gameState.onlinePlayers = [
                { name: 'Host Player', isHost: true },
                { name: gameState.playerName, isHost: false }
            ];
            
            // Set game settings (these would come from server in real implementation)
            gameState.currentGameMode = 'classic';
            gameState.totalQuestions = 10;
            gameState.selectedCategory = 'general';
            
            // Update waiting room
            elements.roomCodeDisplay.textContent = gameState.roomCode;
            elements.roomMode.textContent = 'Classic';
            elements.roomQuestions.textContent = '10';
            elements.roomCategory.textContent = 'General Knowledge';
            
            // Update online players list
            updateOnlinePlayersList();
            
            // Disable start button for non-host
            elements.startOnlineGameBtn.disabled = true;
            
            // Close modal and go to waiting room
            closeModal('joinRoomModal');
            updateNavigation('waiting');
        }

        function generateRoomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function updateOnlinePlayersList() {
            const list = elements.onlinePlayersList;
            
            if (gameState.onlinePlayers.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 py-8">No players connected</div>';
                return;
            }
            
            list.innerHTML = gameState.onlinePlayers.map(player => `
                <div class="player-item">
                    <div class="flex items-center gap-md">
                        <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div class="player-name">${player.name}</div>
                            <div class="text-xs text-gray-400">${player.isHost ? 'Host' : 'Player'}</div>
                        </div>
                    </div>
                    ${player.isHost ? '<span class="text-yellow"><i class="fas fa-crown"></i></span>' : ''}
                </div>
            `).join('');
            
            // Enable start button for host if enough players
            if (gameState.isHost) {
                const mode = gameState.gameModes.find(m => m.id === gameState.currentGameMode);
                elements.startOnlineGameBtn.disabled = gameState.onlinePlayers.length < mode.minPlayers;
            }
        }

        function simulatePlayerJoin(playerName) {
            gameState.onlinePlayers.push({ name: playerName, isHost: false });
            gameState.players.push(playerName);
            updateOnlinePlayersList();
            
            // Show notification
            showFeedback(`${playerName} joined the room!`, 'correct');
        }

        // ===== BUZZER MODE FUNCTIONS =====
        function buzzIn() {
            if (gameState.currentGameMode !== 'buzzer') return;
            
            // Disable buzzer for this player
            elements.buzzerButton.className = 'buzzer-button buzzer-buzzed';
            elements.buzzerButton.disabled = true;
            elements.buzzerInstruction.textContent = 'You buzzed in! Answer now:';
            elements.playerBuzzed.textContent = gameState.playerName;
            
            // Enable answer selection
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.style.pointerEvents = 'auto';
            });
            
            // Show answer options
            elements.answersContainer.style.opacity = '1';
        }

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            // Bottom navigation
            elements.navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const screen = this.dataset.screen;
                    updateNavigation(screen);
                });
            });
            
            // Quick navigation buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('[data-screen]') && !e.target.closest('.nav-item')) {
                    const element = e.target.closest('[data-screen]');
                    const screen = element.dataset.screen;
                    updateNavigation(screen);
                }
            });
            
            // Mode selection buttons
            document.addEventListener('click', function(e) {
                // Play mode button
                if (e.target.closest('.play-mode-btn')) {
                    const btn = e.target.closest('.play-mode-btn');
                    gameState.currentGameMode = btn.dataset.mode;
                    
                    // Clear players for fresh game
                    gameState.players = [];
                    updatePlayersList();
                    
                    updateNavigation('play');
                    navigateToStep(1);
                }
                
                // View mode details button
                if (e.target.closest('.view-mode-btn')) {
                    const btn = e.target.closest('.view-mode-btn');
                    const modeId = btn.dataset.mode;
                    const mode = gameState.gameModes.find(m => m.id === modeId);
                    
                    if (mode) {
                        elements.modeDetailsTitle.textContent = mode.name;
                        elements.modeDetailsSubtitle.textContent = mode.description;
                        
                        // Populate rules
                        elements.modeRules.innerHTML = mode.rules.map(rule => `
                            <div class="flex items-start gap-sm mb-sm">
                                <i class="fas fa-check text-green mt-1"></i>
                                <span>${rule}</span>
                            </div>
                        `).join('');
                        
                        // Populate instructions
                        elements.modeInstructions.innerHTML = mode.instructions.map(instruction => `
                            <div class="flex items-start gap-sm mb-sm">
                                <i class="fas fa-play text-yellow mt-1"></i>
                                <span>${instruction}</span>
                            </div>
                        `).join('');
                        
                        // Update play button
                        elements.playThisModeBtn.onclick = () => {
                            gameState.currentGameMode = modeId;
                            closeModal('modeDetailsModal');
                            updateNavigation('play');
                            navigateToStep(1);
                        };
                        
                        openModal('modeDetailsModal');
                    }
                }
            });
            
            // Player management
            elements.addPlayerBtn.addEventListener('click', () => {
                addPlayer(elements.playerNameInput.value);
            });
            
            elements.playerNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addPlayer(elements.playerNameInput.value);
                }
            });
            
            // Remove player buttons (delegated)
            document.addEventListener('click', function(e) {
                if (e.target.closest('.remove-player-btn')) {
                    const btn = e.target.closest('.remove-player-btn');
                    const playerName = btn.dataset.player;
                    removePlayer(playerName);
                }
            });
            
            // Setup step navigation
            elements.nextStepBtn.addEventListener('click', () => {
                if (gameState.players.length >= 1) {
                    navigateToStep(2);
                } else {
                    alert('Add at least 1 player to continue');
                }
            });
            
            elements.prevStepBtn.addEventListener('click', () => {
                navigateToStep(1);
            });
            
            elements.nextStepBtn2.addEventListener('click', () => {
                navigateToStep(3);
            });
            
            elements.prevStepBtn2.addEventListener('click', () => {
                navigateToStep(2);
            });
            
            elements.startGameBtn.addEventListener('click', startGame);
            
            // Game controls
            elements.nextQuestionBtn.addEventListener('click', nextQuestion);
            
            elements.hintBtn.addEventListener('click', () => {
                // Implement hint functionality
                showFeedback('Hint: Try to eliminate obviously wrong answers first!', 'correct');
                elements.hintBtn.disabled = true;
            });
            
            // Buzzer button
            elements.buzzerButton.addEventListener('click', buzzIn);
            
            // Game complete modal
            elements.backToMenuBtn.addEventListener('click', () => {
                closeModal('gameCompleteModal');
                updateNavigation('home');
            });
            
            elements.playAgainBtn.addEventListener('click', () => {
                closeModal('gameCompleteModal');
                
                if (gameState.isOnlineGame) {
                    // For online games, go back to waiting room
                    updateNavigation('waiting');
                } else {
                    // For local games, restart setup
                    updateNavigation('play');
                    navigateToStep(1);
                }
            });
            
            // Online play buttons
            elements.createRoomBtn.addEventListener('click', () => {
                openModal('createRoomModal');
            });
            
            elements.joinRoomBtn.addEventListener('click', () => {
                openModal('joinRoomModal');
            });
            
            elements.refreshRoomsBtn.addEventListener('click', () => {
                // Simulate refreshing rooms
                elements.roomList.innerHTML = `
                    <div class="room-item">
                        <div>
                            <div class="font-bold">Classic Challenge</div>
                            <div class="text-sm text-gray-400">2/4 players • 10 questions</div>
                        </div>
                        <button class="btn btn-primary btn-sm join-room-btn">
                            Join
                        </button>
                    </div>
                    <div class="room-item">
                        <div>
                            <div class="font-bold">Battle Arena</div>
                            <div class="text-sm text-gray-400">3/8 players • 15 questions</div>
                        </div>
                        <button class="btn btn-primary btn-sm join-room-btn">
                            Join
                        </button>
                    </div>
                `;
                
                showFeedback('Rooms refreshed!', 'correct');
            });
            
            // Create room confirmation
            elements.createRoomConfirmBtn.addEventListener('click', createRoom);
            
            // Join room confirmation
            elements.joinRoomConfirmBtn.addEventListener('click', joinRoom);
            
            // Waiting room buttons
            elements.leaveRoomBtn.addEventListener('click', () => {
                if (confirm('Leave this room?')) {
                    gameState.isOnlineGame = false;
                    gameState.roomCode = null;
                    updateNavigation('online');
                }
            });
            
            elements.startOnlineGameBtn.addEventListener('click', () => {
                if (gameState.isHost) {
                    startGame();
                }
            });
            
            // Room code input formatting
            elements.joinRoomCode.addEventListener('input', function(e) {
                this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });
            
            // Close modals on backdrop click
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
            
            // Escape key to close modal
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                        closeModal(modal.id);
                    });
                }
            });
            
            // Pause game on window blur
            window.addEventListener('blur', () => {
                if (gameState.isGameActive && gameState.currentGameMode !== 'buzzer') {
                    openModal('pauseModal');
                }
            });
            
            // Quit game button
            elements.quitGameBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to quit? Your progress will be lost.')) {
                    closeModal('pauseModal');
                    updateNavigation('home');
                }
            });
        }

        // Make functions globally accessible
        window.removePlayer = removePlayer;
        window.addPlayer = addPlayer;
        window.updateNavigation = updateNavigation;
        window.closeModal = closeModal;
        window.openModal = openModal;
    </script>
</body>
</html>
